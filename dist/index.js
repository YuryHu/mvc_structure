(()=>{"use strict";var e={729:(e,t,s)=>{s.d(t,{A:()=>a});var n=s(601),i=s.n(n),r=s(314),o=s.n(r)()(i());o.push([e.id,".button {\n  font-size: large;\n  cursor: pointer;\n  font-weight: bold;\n  color: var(--button-color);\n  border-radius: 3px;\n  text-transform: uppercase;\n  padding: 0.2rem 1rem;\n  text-align: center;\n}\n\n@media (width < 520px) {\n  .button {\n    font-size: medium;\n  }\n}\n\n.delete-button {\n  background-color: var(--delete-button-back);\n  filter: brightness(0.8);\n}\n\n.button:hover {\n  filter: brightness(1.3);\n  color: goldenrod;\n}\n\n.disabled,\n.disabled:hover {\n  cursor: auto;\n  filter: brightness(0.5);\n  color: var(--button-color);\n}\n",""]);const a=o},895:(e,t,s)=>{s.d(t,{A:()=>c});var n=s(601),i=s.n(n),r=s(314),o=s.n(r),a=s(417),d=s.n(a),l=new URL(s(125),s.b),h=o()(i()),u=d()(l);h.push([e.id,`.footer {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  height: var(--footer-height);\n  border-top: 1px solid white;\n  color: var(--title-color);\n  width: 100%;\n}\n\n.rss-logo {\n  background: url(${u}) center/cover;\n  width: 6rem;\n  height: 2rem;\n  border-radius: 5px;\n}\n`,""]);const c=h},319:(e,t,s)=>{s.d(t,{A:()=>a});var n=s(601),i=s.n(n),r=s(314),o=s.n(r)()(i());o.push([e.id,".github-link {\n  text-decoration: none;\n  color: var(--title-color);\n}\n",""]);const a=o},901:(e,t,s)=>{s.d(t,{A:()=>a});var n=s(601),i=s.n(n),r=s(314),o=s.n(r)()(i());o.push([e.id,".login-form {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  width: 20rem;\n  padding: 3rem 2rem;\n  border-radius: 1rem;\n  border: 1px solid grey;\n}\n\n.login-error-block {\n  text-transform: uppercase;\n  color: red;\n  text-align: center;\n  margin-bottom: 2rem;\n}\n",""]);const a=o},147:(e,t,s)=>{s.d(t,{A:()=>a});var n=s(601),i=s.n(n),r=s(314),o=s.n(r)()(i());o.push([e.id,".input-group {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n.login-label {\n  color: white;\n}\n.login-label::after {\n  content: '*';\n  color: red;\n  margin-left: 0.3rem;\n}\n.login-input {\n  font-size: large;\n  border-radius: 0.5rem;\n}\n.visited:invalid {\n  border: 2px solid red;\n}\n.visited:valid {\n  border: 2px solid green;\n}\n.help-block {\n  color: red;\n  height: 2rem;\n}\n.exclamated::before {\n  content: '! ';\n  color: red;\n}\n",""]);const a=o},947:(e,t,s)=>{s.d(t,{A:()=>a});var n=s(601),i=s.n(n),r=s(314),o=s.n(r)()(i());o.push([e.id,".message-container {\n  display: flex;\n  flex-direction: column;\n  max-width: 18rem;\n  background-color: #1e90ff;\n  border-radius: 1rem;\n  padding: 0 0.5rem;\n}\n\n.message-header,\n.message-footer {\n  display: flex;\n  justify-content: space-between;\n  padding: 0.5rem 1rem;\n  font-weight: bold;\n}\n\n.message-content {\n  padding: 1rem;\n  background-color: var(--main-background);\n  border-radius: 3px;\n}\n\n.message-header span {\n  white-space-collapse: preserve;\n}\n\n.my-message {\n  align-self: end;\n}\n\n.dialog-container {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n\n.author {\n  margin-right: 1rem;\n  color: var(--title-color);\n}\n\n.edit-status-container {\n  color: red;\n}\n\n.status-container,\n.edit-status-container {\n  text-transform: capitalize;\n}\n\n.pending {\n  color: #cd7f32;\n}\n\n.delivered {\n  color: green;\n}\n\n.read {\n  color: greenyellow;\n}\n\n.chosen-message {\n  border: 3px solid yellow;\n}\n",""]);const a=o},115:(e,t,s)=>{s.d(t,{A:()=>a});var n=s(601),i=s.n(n),r=s(314),o=s.n(r)()(i());o.push([e.id,".one-field-edit-form {\n  display: flex;\n  gap: 1rem;\n  width: 100%;\n}\n\n.single-input {\n  flex-grow: 1;\n}\n",""]);const a=o},357:(e,t,s)=>{s.d(t,{A:()=>a});var n=s(601),i=s.n(n),r=s(314),o=s.n(r)()(i());o.push([e.id,".one-field-form {\n  display: flex;\n  gap: 1rem;\n  width: 100%;\n}\n\n.single-input {\n  flex-grow: 1;\n}\n",""]);const a=o},283:(e,t,s)=>{s.d(t,{A:()=>a});var n=s(601),i=s.n(n),r=s(314),o=s.n(r)()(i());o.push([e.id,".searchable-list {\n  display: flex;\n  flex-direction: column;\n  height: calc(100vh - var(--header-height) - var(--footer-height) - 2rem);\n}\n\n.searchable-list-item {\n  cursor: pointer;\n}\n\n.searchable-list-item:hover {\n  color: blueviolet;\n}\n\n.item-list {\n  margin-top: 1rem;\n  border: 1px solid white;\n  border-radius: 1rem;\n  display: flex;\n  flex-direction: column;\n  gap: 0.1rem;\n  padding: 1rem;\n  overflow-y: auto;\n  flex-grow: 1;\n}\n\n.list-header {\n  text-align: center;\n}\n\n.count-container {\n  margin-left: 1rem;\n  background-color: blue;\n  color: yellow;\n  border-radius: 2px;\n  padding: 0 0.5rem;\n}\n",""]);const a=o},823:(e,t,s)=>{s.d(t,{A:()=>a});var n=s(601),i=s.n(n),r=s(314),o=s.n(r)()(i());o.push([e.id,".about-message {\n  text-align: center;\n  margin-bottom: 2rem;\n}\n\n.go-back-button {\n  margin-top: 2rem;\n}\n",""]);const a=o},119:(e,t,s)=>{s.d(t,{A:()=>a});var n=s(601),i=s.n(n),r=s(314),o=s.n(r)()(i());o.push([e.id,".main {\n  width: 100%;\n}\n\n.dialog-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.cotalker-container::before {\n  content: 'Current co-talker:';\n  margin-right: 1rem;\n  color: var(--title-color);\n}\n\n.dialog-wrapper {\n  display: flex;\n  flex-direction: column;\n  height: calc(100vh - var(--header-height) - var(--footer-height) - 2rem);\n  gap: 1rem;\n  width: 100%;\n}\n\n.dialog-header,\n.dialog-container,\n.message-form-wrapper {\n  border: 1px solid white;\n  border-radius: 1rem;\n  padding: 1rem;\n}\n\n.dialog-container {\n  flex-grow: 1;\n  overflow-y: auto;\n}\n\n.active-user {\n  color: greenyellow;\n}\n\n.chat-error-block {\n  color: red;\n  border: 1px solid red;\n  border-radius: 1rem;\n  padding: 1rem;\n}\n\n.initial-dialog-message-container {\n  align-self: center;\n}\n",""]);const a=o},243:(e,t,s)=>{s.d(t,{A:()=>a});var n=s(601),i=s.n(n),r=s(314),o=s.n(r)()(i());o.push([e.id,".submit-button {\n  background-color: var(--submit-button-back);\n}\n",""]);const a=o},208:(e,t,s)=>{s.d(t,{A:()=>a});var n=s(601),i=s.n(n),r=s(314),o=s.n(r)()(i());o.push([e.id,"* {\n  box-sizing: border-box;\n}\n\nbody {\n  margin: 0;\n  color: var(--main-color);\n  background-color: var(--main-background);\n}\n\n:root {\n  --main-color: white;\n  --main-background: #2c2c2c;\n  --submit-button-back: rgb(4, 149, 4);\n  --button-color: white;\n  --delete-button-back: red;\n  --ordinary-button-back: #979090;\n  --title-color: orange;\n  --header-height: 3rem;\n  --footer-height: 3rem;\n}\n\nbody .hidden {\n  display: none;\n}\n\n.container {\n  padding: 0 2rem;\n  display: flex;\n  flex-direction: column;\n  min-height: 100vh;\n}\n\n.page {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n  flex-grow: 1;\n}\n\n.main {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-grow: 1;\n}\n\n.functional-button {\n  background-color: blue;\n}\n\n.app-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  height: var(--header-height);\n}\n\n.app-title,\n.name-block {\n  color: var(--title-color);\n}\n\n.logout-block {\n  display: flex;\n  align-items: center;\n  gap: 2rem;\n}\n\n.logout-button {\n  background-color: red;\n}\n\n.logout-error-block {\n  color: red;\n}\n",""]);const a=o},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var s="",n=void 0!==t[5];return t[4]&&(s+="@supports (".concat(t[4],") {")),t[2]&&(s+="@media ".concat(t[2]," {")),n&&(s+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),s+=e(t),n&&(s+="}"),t[2]&&(s+="}"),t[4]&&(s+="}"),s})).join("")},t.i=function(e,s,n,i,r){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(n)for(var a=0;a<this.length;a++){var d=this[a][0];null!=d&&(o[d]=!0)}for(var l=0;l<e.length;l++){var h=[].concat(e[l]);n&&o[h[0]]||(void 0!==r&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=r),s&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=s):h[2]=s),i&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=i):h[4]="".concat(i)),t.push(h))}},t}},417:e=>{e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},601:e=>{e.exports=function(e){return e[1]}},72:e=>{var t=[];function s(e){for(var s=-1,n=0;n<t.length;n++)if(t[n].identifier===e){s=n;break}return s}function n(e,n){for(var r={},o=[],a=0;a<e.length;a++){var d=e[a],l=n.base?d[0]+n.base:d[0],h=r[l]||0,u="".concat(l," ").concat(h);r[l]=h+1;var c=s(u),g={css:d[1],media:d[2],sourceMap:d[3],supports:d[4],layer:d[5]};if(-1!==c)t[c].references++,t[c].updater(g);else{var m=i(g,n);n.byIndex=a,t.splice(a,0,{identifier:u,updater:m,references:1})}o.push(u)}return o}function i(e,t){var s=t.domAPI(t);return s.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;s.update(e=t)}else s.remove()}}e.exports=function(e,i){var r=n(e=e||[],i=i||{});return function(e){e=e||[];for(var o=0;o<r.length;o++){var a=s(r[o]);t[a].references--}for(var d=n(e,i),l=0;l<r.length;l++){var h=s(r[l]);0===t[h].references&&(t[h].updater(),t.splice(h,1))}r=d}}},659:e=>{var t={};e.exports=function(e,s){var n=function(e){if(void 0===t[e]){var s=document.querySelector(e);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(e){s=null}t[e]=s}return t[e]}(e);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");n.appendChild(s)}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56:(e,t,s)=>{e.exports=function(e){var t=s.nc;t&&e.setAttribute("nonce",t)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(s){!function(e,t,s){var n="";s.supports&&(n+="@supports (".concat(s.supports,") {")),s.media&&(n+="@media ".concat(s.media," {"));var i=void 0!==s.layer;i&&(n+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),n+=s.css,i&&(n+="}"),s.media&&(n+="}"),s.supports&&(n+="}");var r=s.sourceMap;r&&"undefined"!=typeof btoa&&(n+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(n,e,t.options)}(t,e,s)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},125:(e,t,s)=>{e.exports=s.p+"00b43e4ad1166c44d7c3.png"}},t={};function s(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={id:n,exports:{}};return e[n](r,r.exports,s),r.exports}s.m=e,s.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return s.d(t,{a:t}),t},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");if(n.length)for(var i=n.length-1;i>-1&&(!e||!/^http(s?):/.test(e));)e=n[i--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),s.b=document.baseURI||self.location.href,s.nc=void 0,(()=>{var e=s(72),t=s.n(e),n=s(825),i=s.n(n),r=s(659),o=s.n(r),a=s(56),d=s.n(a),l=s(540),h=s.n(l),u=s(113),c=s.n(u),g=s(208),m={};m.styleTagTransform=c(),m.setAttributes=d(),m.insert=o().bind(null,"head"),m.domAPI=i(),m.insertStyleElement=h(),t()(g.A,m),g.A&&g.A.locals&&g.A.locals;class p{routeData;currentPage="";constructor(e){this.routeData=e}redirect(e){const t=this.routeData[e];this.currentPage=t.path,Object.values(this.routeData).forEach((e=>{e.page.classList.add("hidden")})),t.page.classList.remove("hidden"),window.history.replaceState({},"",`/${e}`)}}const b=(e,t,s=null)=>{const n=document.createElement(e);return t.length&&t.forEach((e=>n.classList.add(e))),s&&(n.innerText=s),n};var v=s(729),f={};f.styleTagTransform=c(),f.setAttributes=d(),f.insert=o().bind(null,"head"),f.domAPI=i(),f.insertStyleElement=h(),t()(v.A,f),v.A&&v.A.locals&&v.A.locals;class C{classes;text;constructor(e,t){this.classes=e,this.text=t}render(){return b("div",this.classes,this.text)}}var M=s(901),y={};y.styleTagTransform=c(),y.setAttributes=d(),y.insert=o().bind(null,"head"),y.domAPI=i(),y.insertStyleElement=h(),t()(M.A,y),M.A&&M.A.locals&&M.A.locals;class k{nameInputGroup;passInputGroup;submitButton;errorBlock;constructor(){this.submitButton=new C(["login-button","submit-button","button","disabled"],"Log in").render(),this.errorBlock=b("div",["login-error-block","hidden"]),this.nameInputGroup=new H("login","Name",3,this.errorBlock,this.submitButton,"password","text",!0),this.passInputGroup=new H("password","Password",8,this.errorBlock,this.submitButton,"login","password")}clearForm(){[this.nameInputGroup.input,this.passInputGroup.input].forEach((e=>{const t=e;t.value="",t.classList.remove("visited")})),this.submitButton.classList.add("disabled")}isFormValid(){return this.nameInputGroup.isInputValid()&&this.passInputGroup.isInputValid()}render(){const e=b("form",["login-form"]),t=new C(["functional-button","about-button","button"],"About").render();return e.append(this.nameInputGroup.render(),this.passInputGroup.render(),this.errorBlock,t,this.submitButton),e}}var w=s(319),L={};L.styleTagTransform=c(),L.setAttributes=d(),L.insert=o().bind(null,"head"),L.domAPI=i(),L.insertStyleElement=h(),t()(w.A,L),w.A&&w.A.locals&&w.A.locals;class E{linkText="YuryHu";url="https://github.com/YuryHu";render(){const e=b("a",["github-link"],this.linkText);return e.href=this.url,e}}var U=s(895),I={};I.styleTagTransform=c(),I.setAttributes=d(),I.insert=o().bind(null,"head"),I.domAPI=i(),I.insertStyleElement=h(),t()(U.A,I),U.A&&U.A.locals&&U.A.locals;class A{render(){const e=b("div",["footer"]),t=b("span",[],"2024"),s=b("div",["rss-logo"]);return e.append((new E).render(),t,s),e}}var x=s(357),S={};S.styleTagTransform=c(),S.setAttributes=d(),S.insert=o().bind(null,"head"),S.domAPI=i(),S.insertStyleElement=h(),t()(x.A,S),x.A&&x.A.locals&&x.A.locals;class T{form;button;input;constructor(e,t){this.form=b("div",["one-field-form"]),this.button=new C(["button",`${e}-button`,"functional-button","disabled"],e).render(),this.input=b("input",["single-input"]),this.input.placeholder=t,this.addInputChangeListener()}addInputChangeListener(){this.input.addEventListener("input",(()=>{this.button.classList.toggle("disabled",!this.input.value.length)}))}resetForm(){this.input.value="",this.button.classList.add("disabled")}isValid(){return!!this.input.value.length}render(){return this.form.append(this.input,this.button),this.form}}var B=s(147),F={};F.styleTagTransform=c(),F.setAttributes=d(),F.insert=o().bind(null,"head"),F.domAPI=i(),F.insertStyleElement=h(),t()(B.A,F),B.A&&B.A.locals&&B.A.locals;const D=/^[a-zA-Z0-9]+$/,R=/(?=.*?[0-9])(?=.*?[A-Za-z]).+/;class H{inputName;labelText;autofocus=!1;input;helpBlock;submitButton;errorBlock;siblingName;type;pattern;allowedSymbolsMessage;constructor(e,t,s,n,i,r,o,a=!1){this.siblingName=r,this.inputName=e,this.labelText=t,this.autofocus=a,this.input=b("input",["login-input"]),this.type=o,this.configureInput(s),this.helpBlock=b("div",["help-block",`${this.inputName}-help-block`]),this.submitButton=i,this.errorBlock=n,"password"===o?(this.pattern=R,this.allowedSymbolsMessage="Pass must contain at least one letter and at least one digit"):(this.pattern=D,this.allowedSymbolsMessage=`${this.labelText} can contain only english letters and digits`)}configureInput(e){this.input.name=this.inputName,this.input.setAttribute("id",this.inputName),this.input.setAttribute("type",this.type),this.input.setAttribute("required",""),this.input.setAttribute("minlength",`${e}`),this.autofocus&&this.input.setAttribute("autofocus","")}displayMessage(e){this.helpBlock.classList.add("exclamated"),this.helpBlock.innerText=e}hideMessage(){this.helpBlock.classList.remove("exclamated"),this.helpBlock.innerText=""}getErrorMessage(){if(this.input.value.length){const e=this.input.value.match(this.pattern);return null===e||null!==e&&e[0]!==this.input.value?this.allowedSymbolsMessage:this.input.value.length<this.input.minLength?`${this.labelText} must not be shorter than ${this.input.minLength} symbols`:""}return`${this.labelText} must not be shorter than ${this.input.minLength} symbols`}addInputListener(){this.input.addEventListener("input",(()=>{this.errorBlock.classList.add("hidden"),this.input.classList.add("visited"),this.hideMessage();const e=this.getErrorMessage();e.length&&this.displayMessage(e),this.submitButton.classList.toggle("disabled",!(this.isInputValid()&&this.isSiblingValid()))}))}isInputValid(){return 0===this.helpBlock.innerText.length&&0!==this.input.value.length}isSiblingValid(){const e=document.querySelector(`#${this.siblingName}`);return 0===document.querySelector(`.${this.siblingName}-help-block`).innerText.length&&0!==e.value.length}render(){const e=b("div",["input-group"]),t=b("label",["login-label"],this.labelText);return t.htmlFor=this.inputName,t.setAttribute("title","Field is required"),this.addInputListener(),e.append(t),e.append(this.input),e.append(this.helpBlock),e}}var P=s(283),O={};O.styleTagTransform=c(),O.setAttributes=d(),O.insert=o().bind(null,"head"),O.domAPI=i(),O.insertStyleElement=h(),t()(P.A,O),P.A&&P.A.locals&&P.A.locals;class N{itemElements=[];searchInput;itemList;constructor(){this.searchInput=b("input",["search-input"]),this.searchInput.type="text",this.itemList=b("div",["item-list"])}createItemElement(e){const t=b("div",[e.isLogined?"active-user":"inactive","searchable-list-item"],e.login),s=b("span",["count-container","hidden"],"0");return t.append(s),this.itemElements.push(t),t}updateItemElement(e,t=0,s=!1,n=!1){const i=this.itemElements.find((t=>t.childNodes[0].textContent===e.login));if(i){i.classList.toggle("active-user",e.isLogined);const r=i.children[0];if(t)r.textContent=`${t}`,r.classList.remove("hidden");else if(s&&r.textContent)r.textContent=`${parseInt(r.textContent,10)+1}`,r.classList.remove("hidden");else if(n&&r.textContent){const e=parseInt(r.textContent,10)-1;r.textContent=`${e}`,e||r.classList.add("hidden")}}}addItem(e){const t=this.createItemElement(e);this.itemList.append(t)}displayItems(e){this.itemElements=[],e.forEach((e=>this.createItemElement(e))),this.itemList.innerHTML="",this.itemList.append(...this.itemElements)}addSearchInputListener(){this.searchInput.addEventListener("input",(()=>{this.itemElements.forEach((e=>{e.classList.toggle("hidden",!e.innerText.includes(this.searchInput.value))}))}))}render(){const e=b("div",["searchable-list"]),t=b("h2",["list-header"],"Available  users:");return this.addSearchInputListener(),e.append(t,this.searchInput,this.itemList),e}}var $=s(115),q={};q.styleTagTransform=c(),q.setAttributes=d(),q.insert=o().bind(null,"head"),q.domAPI=i(),q.insertStyleElement=h(),t()($.A,q),$.A&&$.A.locals&&$.A.locals;class G{form;editButton;deleteButton;input;constructor(){this.form=b("div",["one-field-edit-form","hidden"]),this.editButton=new C(["button","edit-button","functional-button","disabled"],"edit").render(),this.deleteButton=new C(["button","delete-button"],"delete").render(),this.input=b("input",["single-input"]),this.addInputChangeListener()}addInputChangeListener(){this.input.addEventListener("input",(()=>{this.editButton.classList.toggle("disabled",!this.input.value.length)}))}resetForm(){this.input.value="",this.editButton.classList.add("disabled")}render(){return this.form.append(this.input,this.editButton,this.deleteButton),this.form}}var _=s(243),j={};j.styleTagTransform=c(),j.setAttributes=d(),j.insert=o().bind(null,"head"),j.domAPI=i(),j.insertStyleElement=h(),t()(_.A,j),_.A&&_.A.locals&&_.A.locals;class V{pageElement;loginForm;loginFormElement;constructor(){this.pageElement=b("div",["login-page","page"]),this.loginForm=new k,this.loginFormElement=this.loginForm.render()}render(){return this.pageElement.append(this.loginFormElement),this.pageElement}}var z=s(119),J={};J.styleTagTransform=c(),J.setAttributes=d(),J.insert=o().bind(null,"head"),J.domAPI=i(),J.insertStyleElement=h(),t()(z.A,J),z.A&&z.A.locals&&z.A.locals;var W=s(947),Y={};Y.styleTagTransform=c(),Y.setAttributes=d(),Y.insert=o().bind(null,"head"),Y.domAPI=i(),Y.insertStyleElement=h(),t()(W.A,Y),W.A&&W.A.locals&&W.A.locals;class X{date;author;editStatusContainer;statusContainer;messageContentContainer;isMyMessage;id;messageContainerElement;constructor(e,t,s){this.id=e.id,this.date=s.formatTimeStamp(e.datetime),this.author=t?"You":e.from,this.editStatusContainer=b("span",["edit-status-container"]),this.statusContainer=b("span",["status-container",this.getStatus(e)],this.getStatus(e)),this.messageContentContainer=b("div",["message-content"],e.text),this.isMyMessage=t,this.messageContainerElement=this.createMessageContainer()}getStatus(e){return e.status.isReaded?"read":e.status.isDelivered?"delivered":"pending"}createHeader(){const e=b("div",["message-header"]),t=b("span",["author"],this.author),s=b("span",[],this.date);return e.append(t,s),e}updateMessageStatus(e){"read"===e?(this.statusContainer.textContent="read",this.statusContainer.classList.replace("delivered","read")):"pending"===this.statusContainer.textContent&&(this.statusContainer.textContent="delivered",this.statusContainer.classList.replace("pending","delivered"))}createFooter(){const e=b("div",["message-footer"]);return e.append(this.editStatusContainer,this.statusContainer),e}createMessageContainer(){const e=this.isMyMessage?["message-container","my-message"]:["message-container"],t=b("div",e);return t.setAttribute("data-id",this.id),this.isMyMessage&&(t.title="use right click to edit or delete message"),t}deleteMessageContainerElement(){this.messageContainerElement.remove()}updateMessageContainerElement(e){this.editStatusContainer.textContent="edited",this.messageContentContainer.textContent=e,this.messageContainerElement.classList.remove("chosen-message")}render(){return this.messageContainerElement.append(this.createHeader(),this.messageContentContainer,this.createFooter()),this.messageContainerElement}}class Z{year=0;month="";day="";hours="";minutes="";seconds="";makeDoubleDigitNumber(e){return e<10?`0${e}`:`${e}`}formatTimeStamp(e){return this.getDateTimeComponents(e),this.getFormattedTime()}getDateTimeComponents(e){const t=new Date(e);this.year=t.getFullYear(),this.month=this.makeDoubleDigitNumber(t.getMonth()+1),this.day=this.makeDoubleDigitNumber(t.getDate()),this.hours=this.makeDoubleDigitNumber(t.getHours()),this.minutes=this.makeDoubleDigitNumber(t.getMinutes()),this.seconds=this.makeDoubleDigitNumber(t.getSeconds())}getFormattedTime(){return`${this.day}-${this.month}-${this.year}   ${this.hours}:${this.minutes}:${this.seconds}`}}class Q{pageElement;dialogWrapper;userList;chatErrorBlock;cotalkerContainer;currentCotalkerLogin="";toUsersButton;userListElement;messageForm;editForm;dateFormatter;dialogContainer;initialDialogMessageContainer;lastCreatedMessageContainer=null;messageContainerInstances=[];messageFormElement;editFormElement;constructor(){this.pageElement=b("div",["chat-page","page"]),this.cotalkerContainer=b("div",["cotalker-container"]),this.userList=new N,this.userListElement=this.userList.render(),this.dialogWrapper=b("div",["dialog-wrapper","hidden"]),this.toUsersButton=new C(["button","functional-button"],"To user list").render(),this.toUsersButton.addEventListener("click",this.handleToUsersButtonClick.bind(this)),this.chatErrorBlock=b("div",["chat-error-block","hidden"]),this.messageForm=new T("send","Message..."),this.dateFormatter=new Z,this.dialogContainer=b("div",["dialog-container"]),this.initialDialogMessageContainer=b("div",["initial-dialog-message-container","hidden"]),this.editForm=new G,this.messageFormElement=this.messageForm.render(),this.editFormElement=this.editForm.render()}handleToUsersButtonClick(){this.toggleViews(),this.currentCotalkerLogin=""}showChatWithUser(e){this.dialogContainer.innerHTML="",this.dialogContainer.append(this.initialDialogMessageContainer),this.currentCotalkerLogin=e.login,this.toggleViews(),this.cotalkerContainer.innerText=e.login,this.cotalkerContainer.classList.toggle("active-user",e.isLogined)}toggleViews(){this.userListElement.classList.toggle("hidden"),this.dialogWrapper.classList.toggle("hidden")}createMain(){const e=b("main",["main"]),t=b("div",["dialog-header"]),s=b("div",["message-form-wrapper"]);return s.append(this.messageFormElement,this.editFormElement),t.append(this.toUsersButton,this.cotalkerContainer),this.dialogWrapper.append(t,this.dialogContainer,s,this.chatErrorBlock),e.append(this.userListElement,this.dialogWrapper),e}addMessageToDialogContainer(e,t){const s=new X(e,t,this.dateFormatter);this.messageContainerInstances.push(s),this.lastCreatedMessageContainer=s.render(),this.dialogContainer.append(this.lastCreatedMessageContainer),this.chatErrorBlock.classList.add("hidden")}getMessageData(){return{addressee:`${this.cotalkerContainer.textContent}`,text:this.messageForm.input.value}}displayChatError(e){this.chatErrorBlock.innerText=e,this.chatErrorBlock.classList.remove("hidden")}displayInitialDialogMessage(e){this.initialDialogMessageContainer.innerText=`Write anything to ${e}`,this.initialDialogMessageContainer.classList.remove("hidden")}hideInitialDialogMessageContainer(){this.initialDialogMessageContainer.classList.add("hidden")}updateMessageStatus(e,t){const s=this.messageContainerInstances.find((t=>t.id===e));s&&s.updateMessageStatus(t)}displayEditForm(e){this.editForm.input.value=e.text,this.editForm.deleteButton.setAttribute("data-message-id",e.id),this.editForm.editButton.setAttribute("data-message-id",e.id),this.messageFormElement.classList.add("hidden"),this.editFormElement.classList.remove("hidden")}hideEditForm(){this.messageFormElement.classList.remove("hidden"),this.editFormElement.classList.add("hidden"),this.editForm.resetForm()}deleteMessageFromDialog(e){const t=this.messageContainerInstances.find((t=>t.id===e));t&&t.deleteMessageContainerElement()}editMessageInDialog(e,t){const s=this.messageContainerInstances.find((t=>t.id===e));s&&s.updateMessageContainerElement(t)}getEditedText(){return this.editForm.input.value}render(){const e=(new A).render();return this.pageElement.append(this.createMain(),e),this.pageElement}}var K=s(823),ee={};ee.styleTagTransform=c(),ee.setAttributes=d(),ee.insert=o().bind(null,"head"),ee.domAPI=i(),ee.insertStyleElement=h(),t()(K.A,ee),K.A&&K.A.locals&&K.A.locals;class te{pageElement;constructor(){this.pageElement=b("div",["about-page","page","hidden"])}createDescription(){return b("div",["about-message"],"This is my chat application")}render(){const e=new C(["go-back-button","button","functional-button"],"Back").render();return this.pageElement.append(this.createDescription(),(new E).render(),e),this.pageElement}}class se{routeData;loginPage;aboutPage;chatPage;logoutBlock;nameContainer;logoutErrorBlock;aboutButton;chosenMessageContainer=void 0;constructor(){this.loginPage=new V,this.aboutPage=new te,this.chatPage=new Q,this.routeData={login:{path:"login",page:this.loginPage.pageElement},about:{path:"about",page:this.aboutPage.pageElement},chat:{path:"chat",page:this.chatPage.pageElement}},this.logoutBlock=b("div",["logout-block","hidden"]),this.nameContainer=b("div",["name-block"]),this.logoutErrorBlock=b("div",["logout-error-block"]),this.aboutButton=new C(["functional-button","about-button","button"],"About").render(),this.createBaseMarkup()}createHeader(){const e=b("h1",["app-title"],"Fun Chat"),t=b("header",["app-header"]),s=new C(["logout-button","button"],"Logout").render();return this.logoutBlock.append(this.logoutErrorBlock,this.nameContainer,s,this.aboutButton),t.append(e,this.logoutBlock),t}createBaseMarkup(){const e=b("div",["container"]);e.append(this.createHeader(),this.loginPage.render(),this.aboutPage.render(),this.chatPage.render()),document.body&&document.body.append(e)}displayLogoutBlock(e){this.nameContainer.innerText=e,this.logoutBlock.classList.remove("hidden")}hideLogoutBlock(){this.logoutBlock.classList.add("hidden")}displayLoginError(e){const{loginForm:{errorBlock:t}}=this.loginPage;t.innerText=e,t.classList.remove("hidden")}displayLogoutError(e){this.logoutErrorBlock.innerText=e}clearLogoutErrorBlock(){this.logoutErrorBlock.innerText=""}clearLoginForm(){this.loginPage.loginForm.clearForm()}hideAboutButton(){this.aboutButton.classList.add("hidden")}displayAboutButton(){this.aboutButton.classList.remove("hidden")}addUserToUserList(e){this.chatPage.userList.addItem(e)}updateUserInUserList(e){this.chatPage.userList.updateItemElement(e)}updateUserInCoTalkerContainer(e){const{cotalkerContainer:t}=this.chatPage;t.textContent===e.login&&t.classList.toggle("active-user",e.isLogined)}displayUsers(e){this.chatPage.userList.displayItems(e)}displayUserInChatView(e){this.chatPage.showChatWithUser(e)}addMessageToDialogContainer(e,t){this.chatPage.addMessageToDialogContainer(e,t),this.chatPage.messageForm.resetForm(),this.chatPage.hideInitialDialogMessageContainer()}getMessageData(){return this.chatPage.getMessageData()}displayChatError(e){this.chatPage.displayChatError(e)}displayUnreadMessagesCount(e,t){t&&this.chatPage.userList.updateItemElement(e,t)}incrementUnreadMessageCount(e){this.chatPage.userList.updateItemElement(e,0,!0)}getCurrentCotalkerLogin(){return this.chatPage.currentCotalkerLogin}displayInitialDialogMessage(e){this.chatPage.displayInitialDialogMessage(e)}scrollCreatedMessageToVisible(){const{lastCreatedMessageContainer:e}=this.chatPage;e&&e.scrollIntoView({behavior:"smooth"})}updateMessageStatus(e,t){this.chatPage.updateMessageStatus(e,t)}setDeliveredStatusToMessagesToCotalcker(e){e.forEach((e=>this.chatPage.updateMessageStatus(e,"delivered")))}getDialogContainer(){return this.chatPage.dialogContainer}decrementUnreadMessagesCountFromUser(e){e&&this.chatPage.userList.updateItemElement(e,0,!1,!0)}displayEditForm(e){this.chatPage.displayEditForm(e)}hideEditForm(){this.chatPage.hideEditForm()}deleteMessageFromDialog(e){this.chatPage.deleteMessageFromDialog(e)}getEditedText(){return this.chatPage.getEditedText()}editMessageInDialog(e,t){this.chatPage.editMessageInDialog(e,t)}selectMessageContainer(e){this.chosenMessageContainer=e,this.chosenMessageContainer.classList.add("chosen-message")}cancelMessageSelection(){this.chosenMessageContainer&&this.chosenMessageContainer.classList.remove("chosen-message")}isSendFormActive(){return!this.chatPage.dialogWrapper.classList.contains("hidden")&&!this.chatPage.messageFormElement.classList.contains("hidden")&&this.chatPage.messageForm.isValid()}isLoginFormActive(){return this.loginPage.loginForm.isFormValid()}}class ne{connection;constructor(){this.connection=new WebSocket("ws://127.0.0.1:4000")}sendUserLoginRequest(e,t){this.connection.send(JSON.stringify({id:e,type:"USER_LOGIN",payload:{user:t}}))}sendUserLogoutRequest(e,t){this.connection.send(JSON.stringify({id:e,type:"USER_LOGOUT",payload:{user:t}}))}sendAuthenticatedUsersRequest(e){this.connection.send(JSON.stringify({id:e,type:"USER_ACTIVE",payload:null}))}sendUnauthorizedUsersRequest(e){this.connection.send(JSON.stringify({id:e,type:"USER_INACTIVE",payload:null}))}sendMessageToUserRequest(e){this.connection.send(JSON.stringify({id:e.id,type:"MSG_SEND",payload:{message:{to:e.addressee,text:e.text}}}))}sendUserHistoryRequest(e,t){this.connection.send(JSON.stringify({id:t,type:"MSG_FROM_USER",payload:{user:{login:e}}}))}sendRequestToSetReadStatus(e){this.connection.send(JSON.stringify({id:e,type:"MSG_READ",payload:{message:{id:e}}}))}sendDeleteRequest(e){this.connection.send(JSON.stringify({id:`${Date.now()}`,type:"MSG_DELETE",payload:{message:{id:e}}}))}sendEditRequest(e,t){this.connection.send(JSON.stringify({id:`${Date.now()}`,type:"MSG_EDIT",payload:{message:{id:e,text:t}}}))}}class ie{socketService;otherUsers=[];currentUser={login:"",password:""};loginRequestId="";logoutRequestId="";authenticatedUsersRequestId="";unauthorizedUsersRequestId="";constructor(e){this.socketService=e}authenticateUser(e){this.currentUser=e,this.loginRequestId=`${Date.now()}`,this.socketService.sendUserLoginRequest(this.loginRequestId,e),this.authenticatedUsersRequestId=`${Date.now()+1}`,this.socketService.sendAuthenticatedUsersRequest(this.authenticatedUsersRequestId),this.unauthorizedUsersRequestId=`${Date.now()+2}`,this.socketService.sendUnauthorizedUsersRequest(this.unauthorizedUsersRequestId)}logoutUser(){this.logoutRequestId=`${Date.now()}`,this.socketService.sendUserLogoutRequest(this.logoutRequestId,this.currentUser)}getUserByLogin(e){return this.otherUsers.find((t=>t.login===e))}updateUserStatus(e){const t=this.otherUsers.find((t=>t.login===e.login));t&&(t.isLogined=e.isLogined)}addNewUser(e){this.otherUsers.push(e)}}class re{socketService;sendMessageRequestId="";userHistories={};constructor(e){this.socketService=e}sendMessageToUser(e){this.sendMessageRequestId=`${Date.now()}`,this.socketService.sendMessageToUserRequest({id:this.sendMessageRequestId,addressee:e.addressee,text:e.text})}getCurrentAndOtherUserMessageHistories(e){e.forEach(((e,t)=>this.socketService.sendUserHistoryRequest(e.login,`${e.login}_${Date.now()+t}`)))}getUnreadMessagesCount(e){return Object.hasOwn(this.userHistories,`${e}`)?this.userHistories[e].filter((t=>!t.status.isReaded&&t.from===e)).length:0}addMessageToUserHistory(e,t){Object.hasOwn(this.userHistories,e)?this.userHistories[e].push(t):this.userHistories[e]=[t]}setReadStatusInCurrentCotalkerHistory(e,t){const s=this.findMessageInUserHistory(e,t);s&&(s.status.isReaded=!0)}setDeliveredStatusToMessagesToUser(e){Object.hasOwn(this.userHistories,e.login)&&this.userHistories[e.login].forEach((e=>{e.status.isDelivered=!0}))}setReadStatusToMessageFromCotalcker(e){this.socketService.sendRequestToSetReadStatus(e)}setReadStatusToMessagesFromCotalcker(e){this.getUnreadFromCotalckerMessagesIds(e).forEach((e=>this.setReadStatusToMessageFromCotalcker(e)))}getToCotalckerMessagesIds(e){return Object.hasOwn(this.userHistories,e)?this.userHistories[e].filter((t=>t.to===e)).map((e=>e.id)):[]}getUnreadFromCotalckerMessagesIds(e){return Object.hasOwn(this.userHistories,e)?this.userHistories[e].filter((t=>t.from===e&&!t.status.isReaded)).map((e=>e.id)):[]}findMessageInHistoriesById(e){const t=Object.values(this.userHistories);for(let s=0;s<t.length;s+=1){const n=t[s].find((t=>t.id===e));if(n)return n}}findMessageInUserHistory(e,t){if(Object.hasOwn(this.userHistories,e))return this.userHistories[e].find((e=>e.id===t))}deleteMessage(e){this.socketService.sendDeleteRequest(e)}deleteMessageFromUserHistory(e,t){Object.hasOwn(this.userHistories,t)&&(this.userHistories[t]=this.userHistories[t].filter((t=>t.id!==e)))}editMessage(e,t){this.socketService.sendEditRequest(e,t)}editMessageInUserHistory(e,t,s){const n=this.findMessageInUserHistory(t,e);n&&(n.status.isEdited=!0,n.text=s)}}class oe{view;router;socketService;userModel;messageModel;usersAdditionsCount=0;isCurrentUserLogined=!1;constructor(){this.socketService=new ne,this.view=new se,this.userModel=new ie(this.socketService),this.messageModel=new re(this.socketService),this.router=new p(this.view.routeData),this.addListeners()}start(){this.isCurrentUserLogined=!!window.sessionStorage.getItem("isLogined"),"/about"===window.location.pathname?this.router.redirect("about"):this.router.redirect(this.isCurrentUserLogined?"chat":"login")}addListeners(){this.addBodyListeners(),this.addEnterListeners(),this.addSocketServiceListeners(),this.view.getDialogContainer().addEventListener("scrollend",(()=>this.messageModel.setReadStatusToMessagesFromCotalcker(this.view.getCurrentCotalkerLogin()))),document.addEventListener("contextmenu",(e=>{const t=e.target.closest(".my-message");if(t){e.preventDefault(),this.view.selectMessageContainer(t);const s=t.dataset.id;if(s){const e=this.messageModel.findMessageInHistoriesById(s);e&&this.view.displayEditForm(e)}}}))}addBodyListeners(){document.body&&document.body.addEventListener("click",(e=>{const t=e.target;t.closest(".about-button")&&this.handleAboutButtonClick();const s=t.closest(".login-button");s&&!s.classList.contains("disabled")&&this.handleLoginButtonClick(),t.closest(".logout-button")&&this.userModel.logoutUser();const n=t.closest(".searchable-list-item");n&&this.handleUserListItemClick({login:`${n.childNodes[0].textContent}`,isLogined:n.classList.contains("active-user")});const i=t.closest(".send-button");i&&!i.classList.contains("disabled")&&this.handleSendButtonClick(),t.closest(".dialog-container")&&(this.messageModel.setReadStatusToMessagesFromCotalcker(this.view.getCurrentCotalkerLogin()),this.view.hideEditForm(),this.view.cancelMessageSelection()),t.closest(".go-back-button")&&this.handleGoBackButtonClick();const r=t.closest(".delete-button");r&&this.handleDeleteButtonClick(r);const o=t.closest(".edit-button");o&&!o.classList.contains("disabled")&&this.handleEditButtonClick(o)}))}addEnterListeners(){document.addEventListener("keydown",(e=>{"Enter"===e.key&&("login"===this.router.currentPage&&this.view.isLoginFormActive()?this.handleLoginButtonClick():"chat"===this.router.currentPage&&this.view.isSendFormActive()&&this.handleSendButtonClick())}))}handleLoginButtonClick(){const e=Object.fromEntries(new FormData(this.view.loginPage.loginFormElement).entries());this.userModel.authenticateUser(e)}handleSendButtonClick(){this.messageModel.sendMessageToUser(this.view.getMessageData()),this.messageModel.setReadStatusToMessagesFromCotalcker(this.view.getCurrentCotalkerLogin())}handleAboutButtonClick(){this.router.redirect("about"),this.isCurrentUserLogined&&this.view.hideAboutButton()}handleGoBackButtonClick(){this.isCurrentUserLogined?(this.view.displayAboutButton(),this.router.redirect("chat")):this.router.redirect("login")}handleDeleteButtonClick(e){const{messageId:t}=e.dataset;t&&this.messageModel.deleteMessage(t)}handleEditButtonClick(e){const{messageId:t}=e.dataset;t&&this.messageModel.editMessage(t,this.view.getEditedText())}handleUserListItemClick(e){this.view.displayUserInChatView(e),Object.hasOwn(this.messageModel.userHistories,e.login)&&this.messageModel.userHistories[e.login].length?this.messageModel.userHistories[e.login].forEach((e=>this.view.addMessageToDialogContainer(e,e.from===this.userModel.currentUser.login))):this.view.displayInitialDialogMessage(e.login)}addSocketServiceListeners(){this.socketService.connection.addEventListener("message",(e=>{const t=JSON.parse(e.data),{payload:{user:s}}=t,{payload:{message:n}}=t;switch(t.type){case"ERROR":this.handleErrorResponse(t.id,t.payload.error);break;case"USER_LOGIN":this.handleLoggingIn();break;case"USER_LOGOUT":this.handleLoggingOut();break;case"USER_EXTERNAL_LOGIN":this.handleExternalLoggingIn(s);break;case"USER_EXTERNAL_LOGOUT":this.handleExternalLogout(s);break;case"MSG_SEND":this.handleMessageSending(n);break;case"MSG_FROM_USER":this.handleUserHistoryResponse(t);break;case"MSG_READ":this.handleMessageReadResponse(t.id,n);break;case"MSG_DELETE":this.handleMessageDeleteResponse(t.id,n);break;case"MSG_EDIT":this.handleMessageEditResponse(t.id,n);break;default:this.handleActiveOrInactiveUsersResponse(t.payload.users)}}))}handleLoggingIn(){this.isCurrentUserLogined=!0,window.sessionStorage.setItem("isLogined","true"),this.view.displayLogoutBlock(this.userModel.currentUser.login),this.view.clearLogoutErrorBlock(),this.router.redirect("chat")}handleLoggingOut(){this.isCurrentUserLogined=!1,window.sessionStorage.setItem("isLogined","false"),this.view.hideLogoutBlock(),this.view.clearLoginForm(),this.router.redirect("login"),this.usersAdditionsCount=0,this.userModel.otherUsers=[]}handleUserHistoryResponse(e){const t=e.id.split("_")[0],s=this.userModel.getUserByLogin(t);this.messageModel.userHistories[t]=e.payload.messages,s&&this.view.displayUnreadMessagesCount(s,this.messageModel.getUnreadMessagesCount(t))}handleMessageSending(e){if(e.from===this.userModel.currentUser.login)return this.messageModel.addMessageToUserHistory(e.to,e),this.view.addMessageToDialogContainer(e,!0),void this.view.scrollCreatedMessageToVisible();if(this.messageModel.addMessageToUserHistory(e.from,e),e.from===this.view.getCurrentCotalkerLogin())return this.view.addMessageToDialogContainer(e,!1),this.view.scrollCreatedMessageToVisible();const t=this.userModel.getUserByLogin(e.from);return t?this.view.incrementUnreadMessageCount(t):void 0}handleExternalLoggingIn(e){this.userModel.otherUsers.some((t=>t.login===e.login))?(this.view.updateUserInUserList(e),this.view.updateUserInCoTalkerContainer(e),this.userModel.updateUserStatus(e)):(this.userModel.addNewUser(e),this.view.addUserToUserList(e)),this.messageModel.setDeliveredStatusToMessagesToUser(e);const t=this.view.getCurrentCotalkerLogin();""!==t&&this.view.setDeliveredStatusToMessagesToCotalcker(this.messageModel.getToCotalckerMessagesIds(t))}handleExternalLogout(e){this.view.updateUserInUserList(e),this.view.updateUserInCoTalkerContainer(e),this.userModel.updateUserStatus(e)}handleCurrentUserMarksCotalkerMessageAsRead(e){this.messageModel.setReadStatusInCurrentCotalkerHistory(this.view.getCurrentCotalkerLogin(),e),this.view.updateMessageStatus(e,"read"),this.view.decrementUnreadMessagesCountFromUser(this.userModel.getUserByLogin(this.view.getCurrentCotalkerLogin()))}handleOtherUserMarksCurrentUserMessageAsRead(e){const t=this.messageModel.findMessageInHistoriesById(e);t&&(t.status.isReaded=!0,t.to===this.view.getCurrentCotalkerLogin()&&this.view.updateMessageStatus(e,"read"))}handleCurrentUserDeleteHisMessageToCotalker(e){this.messageModel.deleteMessageFromUserHistory(e,this.view.getCurrentCotalkerLogin()),this.view.deleteMessageFromDialog(e),this.view.hideEditForm()}handleOtherUserDeleteHisMessageToCurrentUser(e){const t=this.messageModel.findMessageInHistoriesById(e);if(t){const s=t.from;s===this.view.getCurrentCotalkerLogin()&&this.view.deleteMessageFromDialog(e),t.status.isReaded||this.view.decrementUnreadMessagesCountFromUser(this.userModel.getUserByLogin(s)),this.messageModel.deleteMessageFromUserHistory(e,s)}}handleCurrentUserEditHisMessageToCotalker(e,t){this.messageModel.editMessageInUserHistory(e,this.view.getCurrentCotalkerLogin(),t),this.view.editMessageInDialog(e,t),this.view.hideEditForm()}handleOtherUserEditHisMessageToCurrentUser(e,t){const s=this.messageModel.findMessageInHistoriesById(e);if(s){const n=s.from;n===this.view.getCurrentCotalkerLogin()&&this.view.editMessageInDialog(e,t),this.messageModel.editMessageInUserHistory(e,n,t)}}handleMessageDeleteResponse(e,t){e?this.handleCurrentUserDeleteHisMessageToCotalker(t.id):this.handleOtherUserDeleteHisMessageToCurrentUser(t.id)}handleMessageEditResponse(e,t){e?this.handleCurrentUserEditHisMessageToCotalker(t.id,t.text):this.handleOtherUserEditHisMessageToCurrentUser(t.id,t.text)}handleMessageReadResponse(e,t){e?this.handleCurrentUserMarksCotalkerMessageAsRead(t.id):this.handleOtherUserMarksCurrentUserMessageAsRead(t.id)}handleErrorResponse(e,t){switch(e){case this.userModel.loginRequestId:this.view.displayLoginError(t);break;case this.userModel.logoutRequestId:this.view.displayLogoutError(t);break;default:this.view.displayChatError(t)}}handleActiveOrInactiveUsersResponse(e){this.usersAdditionsCount+=1,this.userModel.otherUsers=this.userModel.otherUsers.concat(e.filter((e=>e.login!==this.userModel.currentUser.login))),2===this.usersAdditionsCount&&(this.view.displayUsers(this.userModel.otherUsers),this.messageModel.getCurrentAndOtherUserMessageHistories(this.userModel.otherUsers))}}(new class{controller;constructor(){this.controller=new oe}start(){this.controller.start()}}).start()})()})();